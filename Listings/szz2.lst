C51 COMPILER V9.57.0.0   SZZ2                                                              05/27/2020 00:13:20 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE SZZ2
OBJECT MODULE PLACED IN .\Objects\szz2.obj
COMPILER INVOKED BY: E:\Keil\Keil5\C51\BIN\C51.EXE szz2.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\s
                    -zz2.lst) TABS(2) OBJECT(.\Objects\szz2.obj)

line level    source

   1          //12MHz 秒表
   2          #include <reg51.h>
   3          sbit P2_0=P2^0;
   4          sbit P2_1=P2^1;
   5          sbit P2_2=P2^2;
   6          sbit P2_3=P2^3;
   7          sbit P2_4=P2^4;
   8          sbit P2_5=P2^5;
   9          sbit P2_6=P2^6;
  10          sbit P2_7=P2^7;
  11          sbit P3_0=P3^0;
  12          sbit P3_1=P3^1;
  13          sbit dot=P1^7;
  14          unsigned char code table[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  15          unsigned char d1=0,d2=0,d3=0,d4=0,d5=0,d6=0;
  16          unsigned int time=0;
  17          unsigned int num=0;
  18          unsigned int flag=0;
  19          unsigned int allow=1;
  20          unsigned int anum=0;
  21          void delay(unsigned char cnt)   //延时子程序
  22          {
  23   1        unsigned int i;
  24   1        do
  25   1        {
  26   2          for(i=0;i<165;i++);
  27   2        }while(--cnt);
  28   1      }
  29          
  30          void time1() interrupt 3 //定时器/计数器T1溢出中断
  31          {
  32   1        time++;
  33   1        if(time==4000)
  34   1        {
  35   2          if(d6++==9)
  36   2          {
  37   3            d6=0;
  38   3            if(d5++==5)
  39   3            {
  40   4              d5=0;
  41   4              if(d4++==9)
  42   4              {
  43   5                d4=0;
  44   5                if(d3++==5)
  45   5                {
  46   6                  d3=0;
  47   6                  if(d1!=2)
  48   6                  {
  49   7                    if(d2++==9)
  50   7                    {
  51   8                      d2=0;
  52   8                      d1++;
  53   8                    }
  54   7                  }
C51 COMPILER V9.57.0.0   SZZ2                                                              05/27/2020 00:13:20 PAGE 2   

  55   6                  else if(d2++==3)
  56   6                  {
  57   7                    d1=0;d2=0;
  58   7                  }
  59   6                }
  60   5              }
  61   4            }
  62   3          }
  63   2        time=0;
  64   2        }
  65   1      }
  66          
  67          void display(void)
  68          { 
  69   1        P2&=0xc0;   //关断位选信号
  70   1        P1=table[d1]; //送显示数据
  71   1        P2_0=1;   //选中第一个数码管
  72   1        delay(1);   //延时
  73   1        
  74   1        P2&=0xc0;     //关断位选信号
  75   1        P1=table[d2]; //送显示数据
  76   1        dot=1;      //显示小数点
  77   1        P2_1=1; ;   //选中第二个数码管
  78   1        delay(2);   //延时
  79   1        
  80   1        P2&=0xc0;   //关断位选信号
  81   1        P1=table[d3]; //送显示数据
  82   1        P2_2=1;   //选中第三个数码管
  83   1        delay(1);   //延时
  84   1        
  85   1        P2&=0xc0;     //关断位选信号
  86   1        P1=table[d4]; //送显示数据
  87   1        dot=1;      //显示小数点
  88   1        P2_3=1; ;   //选中第四个数码管
  89   1        delay(1);   //延时
  90   1        
  91   1        P2&=0xc0;     //关断位选信号
  92   1        P1=table[d5]; //送显示数据
  93   1        P2_4=1; ;   //选中第五个数码管
  94   1        delay(2);   //延时
  95   1        
  96   1        P2&=0xc0;     //关断位选信号
  97   1        P1=table[d6]; //送显示数据
  98   1        P2_5=1; ;   //选中第六个数码管
  99   1        delay(1);   //延时
 100   1        P1=0;   //关段码
 101   1        P2&=0xc0; //关位码
 102   1      }
 103          
 104          void shezhi()
 105          {
 106   1        /*****************加一*****************/
 107   1        if(flag==1){
 108   2        if(num==0)//时加一操作
 109   2        {
 110   3          //P2&=0xc3;
 111   3          if(d1!=2)
 112   3            {
 113   4              if(d2++==9)
 114   4                {
 115   5                  d2=0;
 116   5                  d1++;
C51 COMPILER V9.57.0.0   SZZ2                                                              05/27/2020 00:13:20 PAGE 3   

 117   5                }
 118   4            }
 119   3          else if(d2++==3)
 120   3            {
 121   4              d1=0;d2=0;
 122   4            }
 123   3        }
 124   2        if(num==1)//分加一操作
 125   2        {
 126   3          //P2&=0xcc;
 127   3          if(d4++==9)
 128   3          {
 129   4            d4=0;
 130   4            if(d3++==5)
 131   4            {
 132   5              d3=0;
 133   5            }
 134   4          }
 135   3        }
 136   2        if(num==2)//秒加一操作
 137   2        {
 138   3          //P2&=0xf0;
 139   3          if(d6++==9)
 140   3          {
 141   4            d6=0;
 142   4            if(d5++==5)
 143   4            {
 144   5              d5=0;
 145   5            }
 146   4          }
 147   3        }}
 148   1        /*****************减一*****************/
 149   1        if(flag==2){
 150   2        if(num==0)//时减一操作
 151   2        {
 152   3          //P2&=0xc3;
 153   3          if(d2--==0)
 154   3          {
 155   4            d2=9;
 156   4            if(d1--==0)
 157   4            {d1=2;d2=3;}
 158   4          }   
 159   3        }
 160   2        if(num==1)//分减一操作
 161   2        {
 162   3          //P2&=0xcc;
 163   3          if(d4--==0)
 164   3          {
 165   4            d4=9;
 166   4            if(d3--==0)
 167   4            {d3=5,d4=9;}
 168   4          }
 169   3        }
 170   2          if(num==2)//秒减一操作
 171   2        {
 172   3          //P2&=0xf0;
 173   3          if(d6--==0)
 174   3          {
 175   4            d6=9;
 176   4            if(d5--==0)
 177   4            {d5=5,d6=9;}
 178   4          }
C51 COMPILER V9.57.0.0   SZZ2                                                              05/27/2020 00:13:20 PAGE 4   

 179   3        }}  
 180   1      }
 181          
 182          main()
 183          {
 184   1        TMOD=0x20;//写入方式控制字
 185   1        TH1=(256-250);//写入计数初值
 186   1        TL1=(256-250);
 187   1        EA=1;//开中断总开关
 188   1        ET1=1;//定时器1允许中断
 189   1        while(1)
 190   1        {
 191   2          /**********************确定键**********************/
 192   2          if(P2_6==0)
 193   2          {                     //第一次检测到按键信息
 194   3            delay(20);          //延时消除抖动
 195   3            if(P2_6==0)
 196   3            {                   //第二次检测到按键信息
 197   4              if(anum%2==0)
 198   4                {
 199   5                  TR1=1;//启动T1定时
 200   5                  allow=0;
 201   5                }
 202   4              else
 203   4                {
 204   5                  TR1=0;//关闭T1定时
 205   5                  allow=1;
 206   5                }
 207   4              anum++;
 208   4              if(anum==10) anum=0;
 209   4              while(P2_6==0)    //等待按键释放
 210   4              {display();}
 211   4            }
 212   3          }
 213   2          /**********************控制改变时分秒**********************/
 214   2          if(P2_7==0)
 215   2          {                     //第一次检测到按键信息
 216   3            delay(20);          //延时消除抖动
 217   3            if(P2_7==0)
 218   3            {                   //第二次检测到按键信息
 219   4              if(num++==2)
 220   4                num=0;
 221   4              while(P2_7==0)    //等待按键释放
 222   4              {display();}
 223   4            }
 224   3          }   
 225   2          if(allow==1){
 226   3          /**********************实现加1**********************/
 227   3          if(P3_0==0)
 228   3          {                     //第一次检测到按键信息
 229   4            delay(20);          //延时消除抖动
 230   4            if(P3_0==0)
 231   4            {                   //第二次检测到按键信息
 232   5              flag=1;
 233   5              shezhi();
 234   5              while(P3_0==0)    //等待按键释放
 235   5              {display();}
 236   5            }
 237   4          }
 238   3          /**********************实现减1**********************/
 239   3          if(P3_1==0)
 240   3          {                     //第一次检测到按键信息
C51 COMPILER V9.57.0.0   SZZ2                                                              05/27/2020 00:13:20 PAGE 5   

 241   4            delay(20);          //延时消除抖动
 242   4            if(P3_1==0)
 243   4            {                   //第二次检测到按键信息
 244   5              flag=2;
 245   5              shezhi();
 246   5              while(P3_1==0)    //等待按键释放
 247   5              {display();}
 248   5            }
 249   4          }}
 250   2          display();
 251   2        }
 252   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    629    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
