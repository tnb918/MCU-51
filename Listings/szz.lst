C51 COMPILER V9.57.0.0   SZZ                                                               05/26/2020 23:50:18 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE SZZ
OBJECT MODULE PLACED IN .\Objects\szz.obj
COMPILER INVOKED BY: E:\Keil\Keil5\C51\BIN\C51.EXE szz.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\sz
                    -z.lst) TABS(2) OBJECT(.\Objects\szz.obj)

line level    source

   1          //12MHz 秒表 中断
   2          #include <reg51.h>
   3          sbit P2_0=P2^0;
   4          sbit P2_1=P2^1;
   5          sbit P2_2=P2^2;
   6          sbit P2_3=P2^3;
   7          sbit P2_4=P2^4;
   8          sbit P2_5=P2^5;
   9          sbit P2_6=P2^6;
  10          sbit P2_7=P2^7;
  11          sbit dot=P1^7;
  12          unsigned char code table[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  13          unsigned char d1=0,d2=0,d3=0,d4=0,d5=0,d6=0;
  14          unsigned int time=0;
  15          unsigned int num=0;
  16          unsigned int flag=0;
  17          unsigned int allow=0;
  18          unsigned int anum=0;
  19          void delay(unsigned char cnt)   //延时子程序
  20          {
  21   1        unsigned int i;
  22   1        do
  23   1        {
  24   2          for(i=0;i<165;i++);
  25   2        }while(--cnt);
  26   1      }
  27              
  28          void int1() interrupt 2 //外部1中断 确定键
  29          {
  30   1        if(anum%2==0)
  31   1        {
  32   2          TR1=0;//关闭T1定时
  33   2          allow=1;
  34   2        }
  35   1        else
  36   1        {
  37   2          TR1=1;//启动T1定时
  38   2          allow=0;
  39   2        }
  40   1        anum++;
  41   1        if(anum==10) anum=0;
  42   1        
  43   1      }
  44          
  45          void int0() interrupt 0 //外部0中断 改变时分秒
  46          {
  47   1        TR1=0;
  48   1        if(num++==2)
  49   1          num=0;
  50   1      }
  51          
  52          void time1() interrupt 3 //定时器/计数器T1溢出中断
  53          {
  54   1        time++;
C51 COMPILER V9.57.0.0   SZZ                                                               05/26/2020 23:50:18 PAGE 2   

  55   1        if(time==4000)
  56   1        {
  57   2          if(d6++==9)
  58   2          {
  59   3            d6=0;
  60   3            if(d5++==5)
  61   3            {
  62   4              d5=0;
  63   4              if(d4++==9)
  64   4              {
  65   5                d4=0;
  66   5                if(d3++==5)
  67   5                {
  68   6                  d3=0;
  69   6                  if(d1!=2)
  70   6                  {
  71   7                    if(d2++==9)
  72   7                    {
  73   8                      d2=0;
  74   8                      d1++;
  75   8                    }
  76   7                  }
  77   6                  else if(d2++==3)
  78   6                  {
  79   7                    d1=0;d2=0;
  80   7                  }
  81   6                }
  82   5              }
  83   4            }
  84   3          }
  85   2        time=0;
  86   2        }
  87   1      }
  88          
  89          void display(void)
  90          { 
  91   1        P2&=0xc0;   //关断位选信号
  92   1        P1=table[d1]; //送显示数据
  93   1        P2_0=1;   //选中第一个数码管
  94   1        delay(1);   //延时
  95   1        
  96   1        P2&=0xc0;     //关断位选信号
  97   1        P1=table[d2]; //送显示数据
  98   1        dot=1;      //显示小数点
  99   1        P2_1=1; ;   //选中第二个数码管
 100   1        delay(2);   //延时
 101   1        
 102   1        P2&=0xc0;   //关断位选信号
 103   1        P1=table[d3]; //送显示数据
 104   1        P2_2=1;   //选中第三个数码管
 105   1        delay(1);   //延时
 106   1        
 107   1        P2&=0xc0;     //关断位选信号
 108   1        P1=table[d4]; //送显示数据
 109   1        dot=1;      //显示小数点
 110   1        P2_3=1; ;   //选中第四个数码管
 111   1        delay(1);   //延时
 112   1        
 113   1        P2&=0xc0;     //关断位选信号
 114   1        P1=table[d5]; //送显示数据
 115   1        P2_4=1; ;   //选中第五个数码管
 116   1        delay(2);   //延时
C51 COMPILER V9.57.0.0   SZZ                                                               05/26/2020 23:50:18 PAGE 3   

 117   1        
 118   1        P2&=0xc0;     //关断位选信号
 119   1        P1=table[d6]; //送显示数据
 120   1        P2_5=1; ;   //选中第六个数码管
 121   1        delay(1);   //延时
 122   1        P1=0;   //关段码
 123   1        P2&=0xc0; //关位码
 124   1      }
 125          
 126          void shezhi()
 127          {
 128   1        /*****************加一*****************/
 129   1        if(flag==1){
 130   2        if(num==0)//时加一操作
 131   2        {
 132   3          //P2&=0xc3;
 133   3          if(d1!=2)
 134   3            {
 135   4              if(d2++==9)
 136   4                {
 137   5                  d2=0;
 138   5                  d1++;
 139   5                }
 140   4            }
 141   3          else if(d2++==3)
 142   3            {
 143   4              d1=0;d2=0;
 144   4            }
 145   3        }
 146   2        if(num==1)//分加一操作
 147   2        {
 148   3          //P2&=0xcc;
 149   3          if(d4++==9)
 150   3          {
 151   4            d4=0;
 152   4            if(d3++==5)
 153   4            {
 154   5              d3=0;
 155   5            }
 156   4          }
 157   3        }
 158   2        if(num==2)//秒加一操作
 159   2        {
 160   3          //P2&=0xf0;
 161   3          if(d6++==9)
 162   3          {
 163   4            d6=0;
 164   4            if(d5++==5)
 165   4            {
 166   5              d5=0;
 167   5            }
 168   4          }
 169   3        }}
 170   1        /*****************减一*****************/
 171   1        if(flag==2){
 172   2        if(num==0)//时减一操作
 173   2        {
 174   3          //P2&=0xc3;
 175   3          if(d2--==0)
 176   3          {
 177   4            d2=9;
 178   4            if(d1--==0)
C51 COMPILER V9.57.0.0   SZZ                                                               05/26/2020 23:50:18 PAGE 4   

 179   4            {d1=2;d2=3;}
 180   4          }   
 181   3        }
 182   2        if(num==1)//分减一操作
 183   2        {
 184   3          //P2&=0xcc;
 185   3          if(d4--==0)
 186   3          {
 187   4            d4=9;
 188   4            if(d3--==0)
 189   4            {d3=5,d4=9;}
 190   4          }
 191   3        }
 192   2          if(num==2)//秒减一操作
 193   2        {
 194   3          //P2&=0xf0;
 195   3          if(d6--==0)
 196   3          {
 197   4            d6=9;
 198   4            if(d5--==0)
 199   4            {d5=5,d6=9;}
 200   4          }
 201   3        }}  
 202   1      }
 203          
 204          main()
 205          {
 206   1        TMOD=0x20;//写入方式控制字
 207   1        TH1=(256-250);//写入计数初值
 208   1        TL1=(256-250);
 209   1        EA=1;//开中断总开关
 210   1        EX1=1;//允许外部1中断
 211   1        EX0=1;//允许外部0中断
 212   1        IT1=1;
 213   1        IT0=1;//负跳沿产生中断
 214   1        ET1=1;//定时器1允许中断
 215   1        TR1=1;
 216   1        while(1)
 217   1        {
 218   2          if(allow==1){
 219   3          /**********************实现加1**********************/
 220   3          if(P2_6==0)
 221   3          {                     //第一次检测到按键信息
 222   4            delay(30);          //延时约20ms，消除抖动
 223   4            if(P2_6==0)
 224   4            {                   //第二次检测到按键信息
 225   5              flag=1;
 226   5              shezhi();
 227   5              display();
 228   5              while(P2_6==0)    //等待按键释放
 229   5              {display();}
 230   5            }
 231   4          }
 232   3          /**********************实现减1**********************/
 233   3          if(P2_7==0)
 234   3          {                     //第一次检测到按键信息
 235   4            delay(30);          //延时约20ms，消除抖动
 236   4            if(P2_7==0)
 237   4            {                   //第二次检测到按键信息
 238   5              flag=2;
 239   5              shezhi();
 240   5              display();
C51 COMPILER V9.57.0.0   SZZ                                                               05/26/2020 23:50:18 PAGE 5   

 241   5              while(P2_7==0)    //等待按键释放
 242   5              {display();}
 243   5            }
 244   4          }}
 245   2          display();
 246   2        }
 247   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    628    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
